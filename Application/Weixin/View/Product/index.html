<include file="Index/header" />
<script type="text/javascript" src="/Public/js/jQuery.asyncLoading.js"></script>
<style type="text/css">
.product{
    font-size: 1em; 
    margin-bottom: 1em;
}
.product .col-md-3{
    margin-bottom: 1em;
}
.product a{
    color: black;
}
#myTab li{
    padding-left: 15px;
}
#myTab .active a{
    background: #d10101;
}
#myTab li a{
    background: url(/Public/images/icons29.png) repeat;
    color: white;
}
.bottom{
    width: 100%;
    position:fixed;
    bottom:0;
    z-index: 99;
}
.bottom a{
    background: url(/Public/images/icons29.png) ;
    color: white;
    display: inline-block;
    width: 50%;
    text-align: center;
}
#hide-left{
    position: fixed;
    z-index: 99;
    transition: left 2s;
    -moz-transition: left 2s; /* Firefox 4 */
    -webkit-transition: left 2s; /* Safari 和 Chrome */
    -o-transition: left 2s; /* Opera */    
}
#myTab{
    float: left;
    height: 500px;
    overflow: scroll;
}
.hide-left-cls{
    left: -300px;
}
.show-left-cls{
    left: 0;
}
#hide-left img{
    float: left;
    margin-top: 100%;
    cursor: pointer;
}
#show-left-img{
    position: fixed;
    z-index: 99;
    left: -50px;
    margin-top: 220px;   
    transition: left 5s;
    -moz-transition: left 5s; /* Firefox 4 */
    -webkit-transition: left 5s; /* Safari 和 Chrome */
    -o-transition: left 5s; /* Opera */      
}
.addtoCart{
    height: 1.2em;
}
#myTabContent .col-md-3{
    overflow: hidden;
    border-bottom: 1px solid #ddd;
}
</style>
<div class="bottom container_flux">
    <a class="col-xs-6" href="/weixin.php?c=product&a=cartDetail"><img src="/Public/images/bugcart.jpg" alt=""></a><a class="col-xs-6" href="/weixin.php?c=product&a=orderDetail"><img src="/Public/images/order.jpg" alt=""></a> 
</div>
<!-- <div class="container product">
    <img id="show-left-img" src="/Public/images/icons11.png">  
    <div id="hide-left" class="show-left-cls">
    <ul id="myTab" class="nav nav-tabs nav-stacked">
        <volist name="result['productCats']" id="vo" offset="0" length='1'>
        <li class="active">
            <a href="#{$vo.product_cat_id}" data-toggle="tab">{$vo.product_cat_name}</a>
        </li>
        </volist>
        <volist name="result['productCats']" id="vo" offset="1">
        <li>
            <a href="#{$vo.product_cat_id}" data-toggle="tab">{$vo.product_cat_name}</a>
        </li>
        </volist>        
    </ul>
    <img id="hide-left-img" class="img-responsive" src="/Public/images/icons10.png" alt="">  
    </div>    
     <p id="addtoCartP" class="btn" data-toggle="modal" data-target="#myModal5" style="display:none"></p>
    <div id="myTabContent" class="tab-content">
        <volist name="result['productCats']" id="vo">
            <if condition="$i eq 1">
            <div class="tab-pane fade in active" id="{$vo.product_cat_id}">
            <else/>
            <div class="tab-pane fade in" id="{$vo.product_cat_id}">
            </if>
            <volist name="result['products']" id="po">
                <eq name="vo.product_cat_id" value="$po.catid">
                    <div class="col-md-3" attrid="{$po.product_id}">
                        <div class="col-xs-4">
                        <a name="linkdetail" linkid="{$po.product_id}"><img class="img-responsive scrollLoading" data-url="{$po.thumb}" name="thumb" src="/Public/images/load.gif"/></a>
                        </div>
                        <div class="col-xs-8">
                        <h4><a name="productname" linkid="{$po.product_id}">{$po.product_name}</a></h4>
                        <p class="pull-left">单价：¥<span name="productprice" style="color:red">{$po.product_price}</span></p>
                        <img class="addtoCart pull-right" attrid="{$po.product_id}" style="padding-left:0;cursor: pointer;" src="/Public/images/gouwuche.jpg">
                        <div class="clearfix" sytle="display:none"></div>
                        </div>
                    </div>
                </eq>
            </volist>
        </div>
        </volist>      
    </div>
</div> -->
<div class="container product">
    <img id="show-left-img" src="/Public/images/icons11.png">  
    <div id="hide-left" class="show-left-cls">
    <ul id="myTab" class="nav nav-tabs nav-stacked">
        <li class="active">
            <a href="#999" data-toggle="tab">热销商品</a>
        </li>
        <volist name="result['productCats']" id="vo">
        <li>
            <a href="#{$vo.product_cat_id}" data-toggle="tab">{$vo.product_cat_name}</a>
        </li>
        </volist>        
    </ul>
    <img id="hide-left-img" class="img-responsive" src="/Public/images/icons10.png" alt="">  
    </div>    
     <p id="addtoCartP" class="btn" data-toggle="modal" data-target="#myModal5" style="display:none"></p>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade in active" id="999">
        <volist name="result['rxproducts']" id="po">
            <div class="col-md-3" attrid="{$po.product_id}">
                <div class="col-xs-4">
                <a name="linkdetail" linkid="{$po.product_id}"><img class="img-responsive scrollLoading" data-url="{$po.thumb}" name="thumb" src="/Public/images/load.gif"/></a>
                </div>
                <div class="col-xs-8">
                <h4><a name="productname" linkid="{$po.product_id}">{$po.product_name}</a></h4>
                <p class="pull-left">单价：¥<span name="productprice" style="color:red">{$po.product_price}</span></p>
                <img class="addtoCart pull-right" attrid="{$po.product_id}" style="padding-left:0;cursor: pointer;" src="/Public/images/gouwuche.jpg">
                <div class="clearfix" sytle="display:none"></div>
                </div>
            </div>
        </volist>
        </div> 
        <volist name="result['productCats']" id="vo">
            <div class="tab-pane fade in" id="{$vo.product_cat_id}">
            <volist name="result['products']" id="po">
                <eq name="vo.product_cat_id" value="$po.catid">
                    <div class="col-md-3" attrid="{$po.product_id}">
                        <div class="col-xs-4">
                        <a name="linkdetail" linkid="{$po.product_id}"><img class="img-responsive scrollLoading" data-url="{$po.thumb}" name="thumb" src="/Public/images/load.gif"/></a>
                        </div>
                        <div class="col-xs-8">
                        <h4><a name="productname" linkid="{$po.product_id}">{$po.product_name}</a></h4>
                        <p class="pull-left">单价：¥<span name="productprice" style="color:red">{$po.product_price}</span></p>
                        <img class="addtoCart pull-right" attrid="{$po.product_id}" style="padding-left:0;cursor: pointer;" src="/Public/images/gouwuche.jpg">
                        <div class="clearfix" sytle="display:none"></div>
                        </div>
                    </div>
                </eq>
            </volist>
        </div>
        </volist>      
    </div>
</div>
<!-- 模态框（Modal） 购物车-->
<div class="modal fade" id="myModal5" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel5">加入购物车</h4>
            </div>
            <div class="modal-body">
                <div class="col-md-6">
                    <img class="img-responsive" id="modthumb" src="">
                </div>
                <div class="col-md-6" style="text-align:left" id="productmodl">
                    <p id="productid" style="display:none"></p>
                    <p class="productinfo">【产品名称】 <span name="name">车载用品04</span></p>
                    <p class="productinfo" >【产品价格】 ¥<span name="price">466</span></p>   
                    <p class="productinfo" style="display:inline-block">【购买数量】</p>
                    <input id="amount" style="IME-MODE: disabled; WIDTH: 60px; HEIGHT: 1.2em" onkeyup="this.value=this.value.replace(/\D/g,'')"  onafterpaste="this.value=this.value.replace(/\D/g,'')" value=1 maxlength="5" size="14" name="amount" type="text" />
                    <button class="btn" style="display:block" type="button" onclick="product.cart()">确定</button>
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<script>
$(".addtoCart").click(function(){
    var id = $(this).attr("attrid");
    var obj = $('div[attrid='+id+']');
    var productname = obj.find('a[name="productname"]').html();
    var productprice = obj.find('span[name="productprice"]').html();           
    var thumb = obj.find('img[name="thumb"]').attr('src');
    $('#modthumb').attr("src",thumb);
    $('#productid').html(id);
    $('#productmodl').find('span[name="name"]').html(productname);
    $('#productmodl').find('span[name="price"]').html(productprice);
    $("#addtoCartP").trigger("click");
});
var SCOPE = {
'push_url' : '/weixin.php?c=product&a=addToCart',
'jump_url' : '/weixin.php?c=product&a=index',
};

var product = {
    cart : function() {
        var id = $('#productid').html();
        var name = $('span[name="name"]').html();
        var price = $('span[name="price"]').html();
        var amount = $('input[name="amount"]').val();
        var thumb = $("#modthumb").attr("src");
        if(!amount) {
            dialog.error('数量不能为空');
            return;
        }      
        var data = {'id':id,'name':name,'price':price,'amount':amount,"thumb":thumb};
        url = SCOPE.push_url;
        jump_url = SCOPE.jump_url;          
        // 执行异步请求  $.post
        $.post(url,data,function(result){
            if(result.status == 0) {
                return dialog.error(result.message);
            }
            if(result.status == 1) {
                return dialog.success(result.message, jump_url);
            }
        },'JSON');
    }
}  
$(document).ready(function(){
    $("img").load(function () {
        //图片默认隐藏  
        $(this).hide();
        //使用fadeIn特效  
        $(this).stop().fadeIn("5000");
    });
    $(".scrollLoading").scrollLoading(); 
});
$("#hide-left-img").click(function(){
    $("#hide-left").addClass("hide-left-cls");
    $("#hide-left").removeClass("show-left-cls");
    $("#show-left-img").css("left",0);
});

$("#show-left-img").click(function(){
    $("#hide-left").addClass("show-left-cls");
    $("#hide-left").removeClass("hide-left-cls");
    $("#show-left-img").css("left","-50px");
});

$('a[name=linkdetail]').click(function(event){
    for (var i = 0; i < $("#myTab").children().length; i++) {
        if($("#myTab").children().eq(i).attr('class')=='active'){
            var exp = new Date();
            exp.setTime(exp.getTime() + 60000);
            document.cookie = "lii="+i+";expires="+ exp.toGMTString();
        }
    };
    window.location.href="/weixin.php?c=product&a=detail&id="+$(this).attr('linkid');
});
$('a[name=productname]').click(function(event){
    for (var i = 0; i < $("#myTab").children().length; i++) {
        if($("#myTab").children().eq(i).attr('class')=='active'){
            var exp = new Date();
            exp.setTime(exp.getTime() + 60000);
            document.cookie = "lii="+i+";expires="+ exp.toGMTString();
        }
    };
    window.location.href="/weixin.php?c=product&a=detail&id="+$(this).attr('linkid');
});
var lii=getCookie('lii')
if (lii!=null && lii!="") {
     $("#myTab").children().eq(lii).children().eq(0).trigger("click");
}

function getCookie(c_name)
{
if (document.cookie.length>0)
  {
  c_start=document.cookie.indexOf(c_name + "=")
  if (c_start!=-1)
    { 
    c_start=c_start + c_name.length+1 
    c_end=document.cookie.indexOf(";",c_start)
    if (c_end==-1) c_end=document.cookie.length
    return unescape(document.cookie.substring(c_start,c_end))
    } 
  }
return ""
}
</script>
<include file="Index/footer" />