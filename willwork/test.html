<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        body, html {width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
        #allmap{width:100%;height:500px;}
        p{margin-left:5px; font-size:14px;}
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
<script type="text/javascript" src="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"></script>
<!--     <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=yaDRGoon5YoRzAAwH781yUgn"></script> -->
    <title>添加自定义覆盖物</title>
</head>
<body>
    <div id="allmap"></div>
</body>
</html>
<script type="text/javascript">
//声明地址解析器
var geoc = new BMap.Geocoder();
 
//自动定位
var autoLocation = function () {
    if (navigator.geolocation) { //判断浏览器是否能获取当前位置
        navigator.geolocation.getCurrentPosition(AddrSuc, AddrFail);
    }
    else {
        alert("无法自动定位,请输入您的用餐地址");
    }
}
 
//获取当前坐标成功
function AddrSuc(param) {
    var lng = param.coords.longitude;
    var lat = param.coords.latitude;
    var point = new BMap.Point(lng, lat);
    //将gps坐标转换为百度地址坐标
    BMap.Convertor.translate(point, 0, translateCallback);
}
 
//获取坐标失败
function AddrFail(err) {
    alert("自动定位失败");
}
 
//坐标转换
function translateCallback(point) {
     
    geoc.getLocation(point, function (rs) {
        var addComp = rs.addressComponents;  //查询得到的地址对象组件
        //addComp.streetNumber：街道门牌号
        //addComp.city：城市
        //addComp.district：区
        //addComp.street：街道
        //addComp.province：省
        var address = addComp.city + addComp.district + addComp.street;
        var lng_t = point.lng;  //经度
        var lat_t = point.lat;   //纬度  
        alert(address);
        // $(".locationTxt").text("当前位置:" + address);
    })
}
autoLocation();
</script>